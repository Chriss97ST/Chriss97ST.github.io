<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>EMPG Bohrungen</title>

<style>
    body {
        margin: 0;
        padding: 25px;
        background: #0d0d0d;
        color: white;
        font-family: "Segoe UI", Arial, sans-serif;
        opacity: 0;
        transition: opacity 0.8s ease;
    }
    body.loaded { opacity: 1; }

    h1 {
        font-size: clamp(1.8rem, 4vw, 2.6rem);
        margin-bottom: 20px;
    }

    /* Suchfeld */
    .search-box { margin-bottom: 20px; }
    .search-box input {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #333;
        background: #1a1a1a;
        color: white;
        font-size: 1.1rem;
    }

    /* Buttons */
    .btn, .toggle-btn, .back-btn {
        display: inline-block;
        padding: 12px 18px;
        border-radius: 12px;
        background: linear-gradient(145deg, #1a1a1a, #070707);
        border: 1px solid #333;
        text-decoration: none;
        color: white;
        transition: 0.25s;
        overflow: hidden;
        cursor: pointer;
    }
    .btn:hover, .toggle-btn:hover, .back-btn:hover {
        transform: scale(1.05);
        background: linear-gradient(145deg, #222, #111);
    }
    .back-btn { margin-top: 40px; }

    /* Ergebnisbox */
    .result-box {
        margin-top: 20px;
        padding: 18px;
        background: #111;
        border-radius: 12px;
        border: 1px solid #333;
        display: none;
    }

    /* Tabelle */
    table {
        border-collapse: collapse;
        margin-top: 20px;
        width: 100%;
        max-width: 100%;
    }
    table th, table td {
        border: 1px solid #333;
        padding: 8px;
        white-space: nowrap;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Kartenvorschau (4:3) */
    #map {
        width: 100%;
        max-width: 600px;
        aspect-ratio: 4 / 3;
        border-radius: 12px;
        margin-top: 20px;
        display: none;
    }
</style>
</head>
<body>

<h1>EMPG – Bohrungen Finder</h1>

<div class="search-box">
    <input type="text" id="searchInput" placeholder="Ortskürzel eingeben …">
</div>

<button class="btn" onclick="performSearch()">Suchen</button>
<button class="btn" onclick="resetSearch()">Zurücksetzen</button>
<button class="toggle-btn" id="toggleTableBtn" onclick="toggleTable()">Tabelle anzeigen</button>

<div id="results" class="result-box"></div>

<div id="map"></div>

<a class="back-btn" href="index.html">Zurück</a>

<script>
let jsonData = [];
let tableVisible = false;

/* JSON laden */
fetch("empg_bohrungen.json")
    .then(r => r.json())
    .then(d => jsonData = d)
    .catch(err => console.error("Fehler beim Laden:", err));

window.onload = () => document.body.classList.add("loaded");

/* Suche starten */
function performSearch() {
    const q = document.getElementById("searchInput").value.trim().toLowerCase();
    if (!q) return;

    const exact = jsonData.filter(e => e.kuerzel.toLowerCase() === q);
    const similar = jsonData.filter(e => e.kuerzel.toLowerCase().includes(q));

    if (exact.length === 1) {
        showResult(exact[0], false);
    } else if (similar.length > 0) {
        showList(similar, q);
    } else {
        showMessage("Keine Treffer gefunden.");
    }
}

/* Einzelnes Ergebnis anzeigen */
function showResult(item, fromList = false) {
    const box = document.getElementById("results");
    box.style.display = "block";

    box.innerHTML = `
        <h2>${item.ort} (${item.kuerzel})</h2>
        <p>Breite: ${item.breite}</p>
        <p>Länge: ${item.laenge}</p>

        <a class="btn" href="https://maps.google.com/?q=${item.breite},${item.laenge}" target="_blank">Google Maps</a>
    `;

    showMap(item.breite, item.laenge);

    if (fromList) tableVisible = false;
}

/* Liste ähnlicher Treffer */
function showList(list, query) {
    const box = document.getElementById("results");
    box.style.display = "block";
    document.getElementById("map").style.display = "none";

    let html = `<h2>Keine exakte Übereinstimmung – ähnliche Treffer:</h2><ul>`;

    list.forEach(e => {
        html += `<li><a href="#" style="color:#4af" onclick='selectItem(${JSON.stringify(e)})'>
                    ${e.ort} (${e.kuerzel})
                 </a></li>`;
    });

    html += "</ul>";
    box.innerHTML = html;
}

/* Eintrag aus Liste ausgewählt */
function selectItem(item) {
    showResult(item, true);
}

/* Karte anzeigen */
function showMap(lat, lon) {
    const map = document.getElementById("map");
    map.style.display = "block";

    map.innerHTML = `
        <iframe 
            width="100%" 
            height="100%" 
            style="border:0; border-radius: 12px;"
            loading="lazy"
            allowfullscreen
            src="https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.01}%2C${lat-0.01}%2C${lon+0.01}%2C${lat+0.01}&layer=mapnik&marker=${lat}%2C${lon}">
        </iframe>
    `;
}

/* Reset */
function resetSearch() {
    document.getElementById("searchInput").value = "";
    document.getElementById("results").style.display = "none";
    document.getElementById("map").style.display = "none";
}

/* Tabelle ein/ausblenden */
function toggleTable() {
    const btn = document.getElementById("toggleTableBtn");
    const box = document.getElementById("results");

    if (!tableVisible) {
        let html = "<h2>Gesamte Tabelle:</h2><table><tr>";

        const headers = ["ort", "kuerzel", "breite", "laenge"];
        headers.forEach(h => html += `<th>${h}</th>`);
        html += "</tr>";

        jsonData.forEach(row => {
            html += `<tr>
                        <td>${row.ort}</td>
                        <td>${row.kuerzel}</td>
                        <td>${row.breite}</td>
                        <td>${row.laenge}</td>
                    </tr>`;
        });

        html += "</table>";

        box.innerHTML = html;
        box.style.display = "block";
        document.getElementById("map").style.display = "none";

        btn.textContent = "Tabelle verstecken";
        tableVisible = true;

    } else {
        box.style.display = "none";
        btn.textContent = "Tabelle anzeigen";
        tableVisible = false;
    }
}
</script>

</body>
</html>
